#include <Arduino.h>
#include "Arduino_LED_Matrix.h"

ArduinoLEDMatrix matrix;

// 0〜13までの視覚的パターン定義 (12x8 = 96要素)
// 10〜13は12x8の画面内に「10」「11」と2桁を押し込んでいます
uint8_t pin_patterns[14][96] = {
  {0,0,0,1,1,1,1,0,0,0,0,0, 0,0,1,0,0,0,0,1,0,0,0,0, 0,0,1,0,0,0,0,1,0,0,0,0, 0,0,1,0,0,0,0,1,0,0,0,0, 0,0,1,0,0,0,0,1,0,0,0,0, 0,0,1,0,0,0,0,1,0,0,0,0, 0,0,1,0,0,0,0,1,0,0,0,0, 0,0,0,1,1,1,1,0,0,0,0,0}, // 0
  {0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,1,1,0,0,0,0,0,0,0, 0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,1,1,1,0,0,0,0,0,0}, // 1
  {0,0,0,1,1,1,1,0,0,0,0,0, 0,0,1,0,0,0,0,1,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0, 0,0,0,0,0,1,1,0,0,0,0,0, 0,0,0,1,1,0,0,0,0,0,0,0, 0,0,1,0,0,0,0,0,0,0,0,0, 0,0,1,0,0,0,0,0,0,0,0,0, 0,0,1,1,1,1,1,1,0,0,0,0}, // 2
  {0,0,1,1,1,1,0,0,0,0,0,0, 0,0,0,0,0,1,0,0,0,0,0,0, 0,0,0,0,0,1,0,0,0,0,0,0, 0,0,1,1,1,1,0,0,0,0,0,0, 0,0,0,0,0,1,0,0,0,0,0,0, 0,0,0,0,0,1,0,0,0,0,0,0, 0,0,0,0,0,1,0,0,0,0,0,0, 0,0,1,1,1,1,0,0,0,0,0,0}, // 3
  {0,0,1,0,0,1,0,0,0,0,0,0, 0,0,1,0,0,1,0,0,0,0,0,0, 0,0,1,0,0,1,0,0,0,0,0,0, 0,0,1,1,1,1,1,0,0,0,0,0, 0,0,0,0,0,1,0,0,0,0,0,0, 0,0,0,0,0,1,0,0,0,0,0,0, 0,0,0,0,0,1,0,0,0,0,0,0, 0,0,0,0,0,1,0,0,0,0,0,0}, // 4
  {0,0,1,1,1,1,1,0,0,0,0,0, 0,0,1,0,0,0,0,0,0,0,0,0, 0,0,1,0,0,0,0,0,0,0,0,0, 0,0,1,1,1,1,0,0,0,0,0,0, 0,0,0,0,0,1,0,0,0,0,0,0, 0,0,0,0,0,1,0,0,0,0,0,0, 0,0,0,0,0,1,0,0,0,0,0,0, 0,0,1,1,1,1,0,0,0,0,0,0}, // 5
  {0,0,0,1,1,1,0,0,0,0,0,0, 0,0,1,0,0,0,0,0,0,0,0,0, 0,0,1,0,0,0,0,0,0,0,0,0, 0,0,1,1,1,1,0,0,0,0,0,0, 0,0,1,0,0,0,1,0,0,0,0,0, 0,0,1,0,0,0,1,0,0,0,0,0, 0,0,1,0,0,0,1,0,0,0,0,0, 0,0,0,1,1,1,0,0,0,0,0,0}, // 6
  {0,0,1,1,1,1,1,0,0,0,0,0, 0,0,0,0,0,0,1,0,0,0,0,0, 0,0,0,0,0,1,0,0,0,0,0,0, 0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,1,0,0,0,0,0,0,0,0, 0,0,1,0,0,0,0,0,0,0,0,0, 0,0,1,0,0,0,0,0,0,0,0,0, 0,0,1,0,0,0,0,0,0,0,0,0}, // 7
  {0,0,0,1,1,1,0,0,0,0,0,0, 0,0,1,0,0,0,1,0,0,0,0,0, 0,0,1,0,0,0,1,0,0,0,0,0, 0,0,0,1,1,1,0,0,0,0,0,0, 0,0,1,0,0,0,1,0,0,0,0,0, 0,0,1,0,0,0,1,0,0,0,0,0, 0,0,1,0,0,0,1,0,0,0,0,0, 0,0,0,1,1,1,0,0,0,0,0,0}, // 8
  {0,0,0,1,1,1,0,0,0,0,0,0, 0,0,1,0,0,0,1,0,0,0,0,0, 0,0,1,0,0,0,1,0,0,0,0,0, 0,0,0,1,1,1,1,0,0,0,0,0, 0,0,0,0,0,0,1,0,0,0,0,0, 0,0,0,0,0,0,1,0,0,0,0,0, 0,0,1,0,0,0,1,0,0,0,0,0, 0,0,0,1,1,1,0,0,0,0,0,0}, // 9
  {0,1,0,0,1,1,1,0,0,0,0,0, 1,1,0,1,0,0,1,0,0,0,0,0, 0,1,0,1,0,0,1,0,0,0,0,0, 0,1,0,1,0,0,1,0,0,0,0,0, 0,1,0,1,0,0,1,0,0,0,0,0, 0,1,0,1,0,0,1,0,0,0,0,0, 0,1,0,1,0,0,1,0,0,0,0,0, 0,1,0,0,1,1,1,0,0,0,0,0}, // 10
  {0,1,0,0,1,0,0,0,0,0,0,0, 1,1,0,1,1,0,0,0,0,0,0,0, 0,1,0,0,1,0,0,0,0,0,0,0, 0,1,0,0,1,0,0,0,0,0,0,0, 0,1,0,0,1,0,0,0,0,0,0,0, 0,1,0,0,1,0,0,0,0,0,0,0, 0,1,0,0,1,0,0,0,0,0,0,0, 0,1,0,1,1,1,0,0,0,0,0,0}, // 11
  {0,1,0,1,1,1,1,0,0,0,0,0, 1,1,0,0,0,0,1,0,0,0,0,0, 0,1,0,0,0,0,1,0,0,0,0,0, 0,1,0,0,0,1,0,0,0,0,0,0, 0,1,0,0,1,0,0,0,0,0,0,0, 0,1,0,1,0,0,0,0,0,0,0,0, 0,1,0,1,0,0,0,0,0,0,0,0, 0,1,0,1,1,1,1,1,0,0,0,0}, // 12
  {0,1,0,0,1,1,1,0,0,0,0,0, 1,1,0,0,0,0,1,0,0,0,0,0, 0,1,0,0,0,0,1,0,0,0,0,0, 0,1,0,0,1,1,1,0,0,0,0,0, 0,1,0,0,0,0,1,0,0,0,0,0, 0,1,0,0,0,0,1,0,0,0,0,0, 0,1,0,0,0,0,1,0,0,0,0,0, 0,1,0,0,1,1,1,0,0,0,0,0}  // 13
};

void setup() {
    Serial.begin(115200);
    matrix.begin();

    // D0からD13をプルアップ入力に設定
    for (int i = 0; i <= 13; i++) {
        pinMode(i, INPUT_PULLUP);
    }
    Serial.println("--- All Pin Scan Ready (0-13) ---");
}

void loop() {
    bool detected = false;

    for (int i = 0; i <= 13; i++) {
        if (digitalRead(i) == LOW) {
            Serial.print("GND Detected on Pin: ");
            Serial.println(i);
            
            // 全てのピン番号（0-13）に対してパターンをロード
            matrix.loadPixels(pin_patterns[i], 96);
            
            detected = true;
            delay(100); // 連続表示を安定させるための短いディレイ
            break; // 最初に見つかったピンを表示してループを抜ける
        }
    }

    if (!detected) {
        matrix.clear();
    }
}